Fresh Snowy Trout

High

# Missing Fee Beneficiary Validation

### Summary

_No response_

### Root Cause

The **`PoolFactory`** contract allows the creation of pools with an invalid **`feeBeneficiary`** address (e.g., `address(0)`). This flaw locks all accrued protocol fees permanently, rendering them unclaimable. Here's how it unfolds:

1. **Pool Initialization**:
    - When creating a pool via **`createPool`**, the **`feeBeneficiary`** parameter is passed directly to the **`Pool`** contract’s `initialize` function.
    - **No validation** ensures `feeBeneficiary` is non-zero. If set to `address(0)`, the pool stores this invalid address.
2. **Fee Accrual**:
    - The pool accrues fees over time as users interact with it (e.g., creating/redeeming tokens).
    - Fees are calculated as a percentage of the pool’s reserves and accumulate until claimed.
3. **Fee Claim Process**:
    - The **`claimFees()`** function in **`Pool.sol`** checks:
    ```solidity
require(
  msg.sender == feeBeneficiary || poolFactory.hasRole(poolFactory.GOV_ROLE(), msg.sender),
  "NotBeneficiary"
);
```
If feeBeneficiary = address(0), no address can satisfy msg.sender == address(0), and governance can’t bypass this check unless explicitly granted GOV_ROLE.

4. Irreversible Lock:

Once initialized with feeBeneficiary = address(0), there’s no way to update the beneficiary address (the setFeeBeneficiary function is permissioned to governance, but even governance can’t claim fees if the check above fails).

Fees remain stuck in the pool contract forever.

https://github.com/sherlock-audit/2024-12-plaza-finance/blob/main/plaza-evm/src/Pool.sol#L699C1-L713C1



### Internal Pre-conditions

_No response_

### External Pre-conditions

_No response_

### Attack Path

Accidental Misconfiguration:

Action: A governance member mistakenly sets feeBeneficiary = address(0) during pool creation.

Result: All fees generated by the pool become unclaimable. Governance must redeploy the pool, causing operational delays and loss of revenue.

### Impact

_No response_

### PoC

_No response_

### Mitigation

_No response_